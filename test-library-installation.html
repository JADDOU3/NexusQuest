<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusQuest - Library Installation Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        button {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #764ba2;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .button-group button {
            flex: 1;
        }
        
        .output {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .loading {
            color: #667eea;
            font-weight: bold;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .status.ready {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§ª NexusQuest - Library Installation Tester</h1>
        
        <div class="test-section">
            <h2>Setup</h2>
            <div class="form-group">
                <label>Authentication Token:</label>
                <input type="password" id="token" placeholder="Enter your JWT token">
            </div>
            <div id="status" class="status ready">Ready to test</div>
            <button onclick="validateToken()">Validate Token</button>
        </div>
        
        <div class="grid-2">
            <div class="test-section">
                <h2>1. Create JavaScript Project</h2>
                <div class="form-group">
                    <label>Project Name:</label>
                    <input type="text" id="jsProjectName" value="Test JS Project">
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <input type="text" id="jsProjectDesc" value="Testing package.json generation">
                </div>
                <button onclick="createJSProject()">Create Project</button>
                <div id="jsProjectOutput" class="output" style="display:none;"></div>
            </div>
            
            <div class="test-section">
                <h2>2. Create Python Project</h2>
                <div class="form-group">
                    <label>Project Name:</label>
                    <input type="text" id="pyProjectName" value="Test Python Project">
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <input type="text" id="pyProjectDesc" value="Testing requirements.txt generation">
                </div>
                <button onclick="createPythonProject()">Create Project</button>
                <div id="pyProjectOutput" class="output" style="display:none;"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>3. Manage Dependencies</h2>
            <div class="form-group">
                <label>Project ID:</label>
                <input type="text" id="projectId" placeholder="Paste project ID from step 1 or 2">
            </div>
            <div class="form-group">
                <label>Action:</label>
                <select id="depAction">
                    <option value="add">Add Dependency</option>
                    <option value="list">List Dependencies</option>
                    <option value="update">Update All Dependencies</option>
                    <option value="delete">Delete Dependency</option>
                </select>
            </div>
            <div id="depFormFields"></div>
            <button onclick="manageDependencies()">Execute</button>
            <div id="depOutput" class="output" style="display:none;"></div>
        </div>
        
        <div class="test-section">
            <h2>4. Execute with Dependencies</h2>
            <div class="form-group">
                <label>Language:</label>
                <select id="execLanguage" onchange="updateCodeTemplate()">
                    <option value="javascript">JavaScript</option>
                    <option value="python">Python</option>
                </select>
            </div>
            <div class="form-group">
                <label>Code:</label>
                <textarea id="execCode">const axios = require('axios');
const _ = require('lodash');

console.log('Testing dependencies:');
console.log('Axios loaded successfully');
console.log('Lodash loaded successfully');
console.log('Success!');</textarea>
            </div>
            <div class="form-group">
                <label>Dependencies (JSON format):</label>
                <textarea id="execDeps">{"axios": "1.6.0", "lodash": "4.17.21"}</textarea>
            </div>
            <div class="form-group">
                <label>Input (optional):</label>
                <input type="text" id="execInput" placeholder="Leave empty if not needed">
            </div>
            <button onclick="executeWithDependencies()">Execute</button>
            <div id="execOutput" class="output" style="display:none;"></div>
        </div>
        
        <div class="test-section">
            <h2>Test Results</h2>
            <div id="testResults" style="color: #666;">
                No tests run yet. Start by creating a project above.
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        let currentToken = '';
        let testResults = [];

        function getToken() {
            currentToken = document.getElementById('token').value;
            if (!currentToken) {
                showStatus('Please enter a token first', 'error');
                return null;
            }
            return currentToken;
        }

        function showStatus(message, type = 'ready') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function showOutput(elementId, content) {
            const el = document.getElementById(elementId);
            el.textContent = content;
            el.style.display = 'block';
        }

        function updateTestResults(test, passed, details) {
            const status = passed ? 'âœ“' : 'âœ—';
            const color = passed ? 'color: #27ae60' : 'color: #e74c3c';
            testResults.push({ test, passed, details });
            
            const resultsEl = document.getElementById('testResults');
            let html = '<ul style="list-style: none;">';
            testResults.forEach(r => {
                const icon = r.passed ? 'âœ“' : 'âœ—';
                html += `<li style="${r.passed ? 'color: #27ae60' : 'color: #e74c3c'}"><strong>${icon} ${r.test}</strong><br><small>${r.details}</small></li>`;
            });
            html += '</ul>';
            resultsEl.innerHTML = html;
        }

        async function validateToken() {
            const token = getToken();
            if (!token) return;
            
            try {
                showStatus('Validating token...', 'loading');
                const response = await fetch(`${API_BASE}/projects`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    showStatus('Token is valid!', 'ready');
                    updateTestResults('Token Validation', true, 'Authentication successful');
                } else {
                    showStatus('Invalid token', 'error');
                    updateTestResults('Token Validation', false, 'Authentication failed');
                }
            } catch (error) {
                showStatus(`Error: ${error.message}`, 'error');
                updateTestResults('Token Validation', false, error.message);
            }
        }

        async function createJSProject() {
            const token = getToken();
            if (!token) return;
            
            const name = document.getElementById('jsProjectName').value;
            const description = document.getElementById('jsProjectDesc').value;
            
            try {
                showStatus('Creating JavaScript project...', 'loading');
                const response = await fetch(`${API_BASE}/projects`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        description,
                        language: 'javascript'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('projectId').value = data.data._id;
                    
                    const hasPackageJson = data.data.files.some(f => f.name === 'package.json');
                    let output = `Project ID: ${data.data._id}\n\n`;
                    output += `Files created:\n`;
                    data.data.files.forEach(f => output += `  - ${f.name}\n`);
                    
                    if (hasPackageJson) {
                        output += `\npackage.json content:\n`;
                        const pkgFile = data.data.files.find(f => f.name === 'package.json');
                        output += pkgFile.content;
                    }
                    
                    showOutput('jsProjectOutput', output);
                    showStatus('JavaScript project created successfully!', 'ready');
                    updateTestResults('Create JS Project', true, `Project ID: ${data.data._id}, package.json generated: ${hasPackageJson}`);
                } else {
                    showOutput('jsProjectOutput', `Error: ${data.error}`);
                    showStatus(`Error: ${data.error}`, 'error');
                    updateTestResults('Create JS Project', false, data.error);
                }
            } catch (error) {
                showOutput('jsProjectOutput', `Error: ${error.message}`);
                showStatus(`Error: ${error.message}`, 'error');
                updateTestResults('Create JS Project', false, error.message);
            }
        }

        async function createPythonProject() {
            const token = getToken();
            if (!token) return;
            
            const name = document.getElementById('pyProjectName').value;
            const description = document.getElementById('pyProjectDesc').value;
            
            try {
                showStatus('Creating Python project...', 'loading');
                const response = await fetch(`${API_BASE}/projects`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        description,
                        language: 'python'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    let output = `Project ID: ${data.data._id}\n\n`;
                    output += `Files created:\n`;
                    data.data.files.forEach(f => output += `  - ${f.name}\n`);
                    
                    showOutput('pyProjectOutput', output);
                    showStatus('Python project created successfully!', 'ready');
                    updateTestResults('Create Python Project', true, `Project ID: ${data.data._id}`);
                } else {
                    showOutput('pyProjectOutput', `Error: ${data.error}`);
                    showStatus(`Error: ${data.error}`, 'error');
                    updateTestResults('Create Python Project', false, data.error);
                }
            } catch (error) {
                showOutput('pyProjectOutput', `Error: ${error.message}`);
                showStatus(`Error: ${error.message}`, 'error');
                updateTestResults('Create Python Project', false, error.message);
            }
        }

        function updateDependencyForm() {
            const action = document.getElementById('depAction').value;
            const fieldsDiv = document.getElementById('depFormFields');
            
            fieldsDiv.innerHTML = '';
            
            switch (action) {
                case 'add':
                    fieldsDiv.innerHTML = `
                        <div class="form-group">
                            <label>Package Name:</label>
                            <input type="text" id="depName" placeholder="e.g., axios">
                        </div>
                        <div class="form-group">
                            <label>Version:</label>
                            <input type="text" id="depVersion" placeholder="e.g., 1.6.0 (optional)">
                        </div>
                    `;
                    break;
                case 'update':
                    fieldsDiv.innerHTML = `
                        <div class="form-group">
                            <label>Dependencies (JSON):</label>
                            <textarea id="depJson">{"axios": "1.6.0", "lodash": "4.17.21"}</textarea>
                        </div>
                    `;
                    break;
                case 'delete':
                    fieldsDiv.innerHTML = `
                        <div class="form-group">
                            <label>Package Name:</label>
                            <input type="text" id="depName" placeholder="e.g., axios">
                        </div>
                    `;
                    break;
            }
        }

        document.getElementById('depAction').addEventListener('change', updateDependencyForm);
        updateDependencyForm();

        async function manageDependencies() {
            const token = getToken();
            if (!token) return;
            
            const projectId = document.getElementById('projectId').value;
            if (!projectId) {
                showStatus('Please enter a project ID', 'error');
                return;
            }
            
            const action = document.getElementById('depAction').value;
            let url = `${API_BASE}/projects/${projectId}/dependencies`;
            let method = 'GET';
            let body = null;
            
            try {
                showStatus(`${action}...`, 'loading');
                
                if (action === 'add') {
                    method = 'POST';
                    const name = document.getElementById('depName').value;
                    const version = document.getElementById('depVersion').value;
                    body = { name, version: version || '*' };
                } else if (action === 'update') {
                    method = 'PUT';
                    const depsJson = document.getElementById('depJson').value;
                    body = { dependencies: JSON.parse(depsJson) };
                } else if (action === 'delete') {
                    method = 'DELETE';
                    const name = document.getElementById('depName').value;
                    url += `/${name}`;
                }
                
                const options = {
                    method,
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                };
                
                if (body) {
                    options.body = JSON.stringify(body);
                }
                
                const response = await fetch(url, options);
                const data = await response.json();
                
                if (response.ok) {
                    let output = JSON.stringify(data, null, 2);
                    showOutput('depOutput', output);
                    showStatus('Operation successful!', 'ready');
                    updateTestResults(`Manage Dependencies (${action})`, true, `Operation completed`);
                } else {
                    showOutput('depOutput', `Error: ${data.error}`);
                    showStatus(`Error: ${data.error}`, 'error');
                    updateTestResults(`Manage Dependencies (${action})`, false, data.error);
                }
            } catch (error) {
                showOutput('depOutput', `Error: ${error.message}`);
                showStatus(`Error: ${error.message}`, 'error');
                updateTestResults(`Manage Dependencies (${action})`, false, error.message);
            }
        }

        function updateCodeTemplate() {
            const language = document.getElementById('execLanguage').value;
            const codeEl = document.getElementById('execCode');
            const depsEl = document.getElementById('execDeps');
            
            if (language === 'javascript') {
                codeEl.value = `const axios = require('axios');
const _ = require('lodash');

console.log('Testing dependencies:');
console.log('Axios loaded successfully');
console.log('Lodash loaded successfully');
console.log('Success!');`;
                depsEl.value = '{"axios": "1.6.0", "lodash": "4.17.21"}';
            } else if (language === 'python') {
                codeEl.value = `import requests
import numpy as np

print('Testing dependencies:')
print('Requests loaded successfully')
print('NumPy loaded successfully')
print('Success!')`;
                depsEl.value = '{"requests": "2.31.0", "numpy": "1.24.0"}';
            }
        }

        async function executeWithDependencies() {
            const token = getToken();
            if (!token) return;
            
            const language = document.getElementById('execLanguage').value;
            const code = document.getElementById('execCode').value;
            const input = document.getElementById('execInput').value || undefined;
            
            try {
                const depsJson = document.getElementById('execDeps').value;
                const dependencies = JSON.parse(depsJson);
                
                showStatus('Executing code...', 'loading');
                const response = await fetch(`${API_BASE}/execution/run-project`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        files: [
                            {
                                name: language === 'javascript' ? 'main.js' : 'main.py',
                                content: code,
                                language
                            }
                        ],
                        mainFile: language === 'javascript' ? 'main.js' : 'main.py',
                        language,
                        dependencies,
                        input
                    })
                });
                
                const data = await response.json();
                
                let output = `Status: ${data.success ? 'Success' : 'Failed'}\n`;
                output += `Execution Time: ${data.executionTime}ms\n\n`;
                output += `Output:\n${data.output}\n\n`;
                if (data.error) {
                    output += `Errors:\n${data.error}`;
                }
                
                showOutput('execOutput', output);
                showStatus('Execution completed!', 'ready');
                updateTestResults('Execute with Dependencies', data.success, `Execution Time: ${data.executionTime}ms`);
            } catch (error) {
                const output = `Error: ${error.message}`;
                showOutput('execOutput', output);
                showStatus(`Error: ${error.message}`, 'error');
                updateTestResults('Execute with Dependencies', false, error.message);
            }
        }
    </script>
</body>
</html>
